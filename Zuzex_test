1.Написать запрос для вывода пользователей, которые не создали ни одного
поста и не оставили ни одного коммента. (несколько вариантов запроса)

SELECT *
FROM USERS
WHERE ID NOT IN (SELECT USERID FROM COMMENTS) AND ID NOT IN (select OwnerUserId FROM POSTS)


2. Написать запрос для вывода года, кол-ва постов за год и кол-во комментов за
год.

WITH PROCESSED_COMMENTS AS(
SELECT ID AS COMM_ID, EXTRACT(YEAR FROM CREATIONDATE) AS YEAR
FROM COMMENTS),
PROCESSED_POSTS AS(
SELECT ID AS POST_ID, EXTRACT(YEAR FROM CREATIONDATE) AS YEAR
FROM POSTS)


SELECT PPS.YEAR, COUNT(DISTINCT POST_ID) AS COUNT_OF_POSTS, COUNT(DISTINCT COMM_ID) AS COUNT_OF_COMMENTS
FROM PROCESSED_POSTS AS PPS
FULL JOIN PROCESSED_COMMENTS AS PPC ON
PPS.YEAR = PPC.YEAR
GROUP BY PPS.YEAR

3. Вывести 3 самых активных (по кол-ву комментариев) пользователей (display
name) и их кол-во комментариев

WITH RANKED_COMMENTS_TABLE AS (
SELECT DISTINCT UserID, COUNT(ID) OVER(PARTITION BY UserID) AS COMMENT_COUNT
FROM
COMMENTS
ORDER BY COMMENT_COUNT DESC
LIMIT 3)


SELECT DISPLAYNAME, COMMENT_COUNT
FROM RANKED_COMMENTS_TABLE AS RCT INNER JOIN USERS U
ON RCT.UserID=U.ID

4. Расширить п.3, добавив процент кол-ва комментариев пользователя от общего
кол-ва


WITH RANKED_COMMENTS_TABLE AS (
SELECT DISTINCT UserID, COUNT(ID) OVER(PARTITION BY UserID) AS COMMENT_COUNT, SUM(ID) OVER() AS TOTAL_COMMENTS
FROM COMMENTS
ORDER BY COMMENT_COUNT DESC
LIMIT 3)

SELECT DISPLAYNAME, COMMENT_COUNT, CONCAT((COMMENT_COUNT * 100) / TOTAL_COMMENTS, '%') AS PERCANTAGE_TOTAL
FROM RANKED_COMMENTS_TABLE AS RCT INNER JOIN USERS U
ON RCT.UserID=U.ID
